<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>å®¢è£½åŒ–ç¥ç¦å¡ç‰‡</title>
    <link rel="stylesheet" href="style.css">
    <!-- å¼•å…¥ LINE LIFF SDK -->
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
    <div class="container">
        <h2>âœ¨ è£½ä½œä½ çš„å°ˆå±¬è³€å¡</h2>
        
        <div class="input-group">
            <label for="nameInput">è¼¸å…¥åå­—ï¼š</label>
            <input type="text" id="nameInput" placeholder="ä¾‹å¦‚: ç‹å°æ˜" maxlength="10">
            
            <label for="msgInput">è¼¸å…¥ç¥ç¦èªï¼š</label>
            <input type="text" id="msgInput" placeholder="ä¾‹å¦‚: é¦¬ä¸Šæœ‰éŒ¢" maxlength="12">
            
            <button id="generateBtn">ç”Ÿæˆåœ–ç‰‡</button>
        </div>

        <!-- é è¦½å€åŸŸ -->
        <div class="preview-area" id="previewArea" style="display:none;">
            <div class="divider"></div>
            <p class="hint">ğŸ‘‡ é•·æŒ‰åœ–ç‰‡å³å¯å„²å­˜å‚³é€ ğŸ‘‡</p>
            <img id="resultImage" alt="Generated Image">
            <a id="downloadLink" class="download-btn" href="#" download="card.png">ä¸‹è¼‰åœ–ç‰‡</a>
        </div>

        <!-- éš±è—çš„ç¹ªåœ–å€ (ä½¿ç”¨è€…çœ‹ä¸åˆ°) -->
        <canvas id="canvas" style="display:none;"></canvas>
    </div>

    <script src="script.js"></script>
</body>
</html>
body {
    font-family: "Microsoft JhengHei", "Heiti TC", sans-serif;
    background-color: #f5f5f5;
    margin: 0;
    padding: 20px;
    display: flex;
    justify-content: center;
    min-height: 100vh;
}

.container {
    background: white;
    width: 100%;
    max-width: 480px; /* æ‰‹æ©Ÿå¯¬åº¦é©é… */
    padding: 25px;
    border-radius: 16px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    text-align: center;
    box-sizing: border-box;
}

h2 {
    color: #333;
    margin-top: 0;
    margin-bottom: 20px;
    font-size: 1.5rem;
}

label {
    display: block;
    text-align: left;
    margin: 15px 0 5px;
    font-weight: bold;
    color: #555;
    font-size: 0.95rem;
}

input {
    width: 100%;
    padding: 12px;
    border: 2px solid #eee;
    border-radius: 8px;
    font-size: 16px;
    outline: none;
    box-sizing: border-box; /* ç¢ºä¿å¯¬åº¦åŒ…å« padding */
    transition: border-color 0.3s;
}

input:focus {
    border-color: #06c755;
}

button {
    width: 100%;
    margin-top: 25px;
    padding: 15px;
    background-color: #06c755; /* LINE å®˜æ–¹ç¶ è‰² */
    color: white;
    border: none;
    border-radius: 50px;
    font-size: 18px;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 4px 6px rgba(6, 199, 85, 0.2);
    transition: background-color 0.2s;
}

button:hover {
    background-color: #05a546;
}

button:active {
    transform: scale(0.98);
}

.divider {
    height: 1px;
    background: #eee;
    margin: 25px 0;
}

.hint {
    color: #888;
    font-size: 14px;
    margin-bottom: 10px;
}

#resultImage {
    width: 100%;
    height: auto;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.15);
    border: 1px solid #eee;
}

.download-btn {
    display: block;
    margin-top: 15px;
    padding: 12px;
    background-color: #333;
    color: #fff;
    text-decoration: none;
    border-radius: 8px;
    font-size: 14px;
}
// ==========================================
//           â–¼â–¼â–¼ è¨­å®šå€åŸŸ â–¼â–¼â–¼
// ==========================================

const config = {
    // ä½ çš„ LINE LIFF ID (å·²è¨­å®šå¥½)
    liffId: "2008578496-5ovBYvYv", 

    // èƒŒæ™¯åœ–ç‰‡æª”å (è«‹ç¢ºèª GitHub ä¸Šæœ‰é€™å¼µåœ–)
    bgImage: "template.jpg", 

    // ã€Œåå­—ã€çš„æ–‡å­—è¨­å®š
    nameText: {
        x: 540,           // å·¦å³ä½ç½® (å‡è¨­åœ–ç‰‡å¯¬1080ï¼Œ540ç‚ºä¸­é–“)
        y: 400,           // ä¸Šä¸‹ä½ç½® (æ•¸å­—è¶Šå¤§è¶Šä¸‹é¢)
        size: "60px",     // å­—é«”å¤§å°
        color: "#333333", // å­—é«”é¡è‰² (é»‘è‰²)
        font: "Microsoft JhengHei"
    },

    // ã€Œç¥ç¦èªã€çš„æ–‡å­—è¨­å®š
    msgText: {
        x: 540,           // å·¦å³ä½ç½®
        y: 600,           // ä¸Šä¸‹ä½ç½®
        size: "50px",     // å­—é«”å¤§å°
        color: "#ff5500", // å­—é«”é¡è‰² (æ©˜ç´…è‰²)
        font: "Microsoft JhengHei"
    }
};

// ==========================================
//           â–²â–²â–² ç¨‹å¼é‚è¼¯ (å…ä¿®æ”¹) â–²â–²â–²
// ==========================================

window.onload = function() {
    initializeLiff(config.liffId);
    document.getElementById('generateBtn').addEventListener('click', generateImage);
};

// åˆå§‹åŒ– LIFF
function initializeLiff(myLiffId) {
    liff.init({ liffId: myLiffId })
        .then(() => {
            // å¦‚æœæ˜¯åœ¨ LINE App å…§é–‹å•Ÿï¼Œå˜—è©¦è‡ªå‹•æŠ“å–åå­—
            if (liff.isLoggedIn()) {
                liff.getProfile().then(profile => {
                    const nameInput = document.getElementById('nameInput');
                    if(nameInput) {
                        nameInput.value = profile.displayName; // è‡ªå‹•å¡«å…¥æš±ç¨±
                    }
                }).catch(err => console.error("ç„¡æ³•å–å¾—å€‹äººè³‡æ–™", err));
            }
        })
        .catch((err) => {
            console.error('LIFF åˆå§‹åŒ–å¤±æ•—:', err);
        });
}

// ç”Ÿæˆåœ–ç‰‡çš„ä¸»è¦åŠŸèƒ½
function generateImage() {
    const nameInput = document.getElementById('nameInput').value || "æœ‹å‹";
    const msgInput = document.getElementById('msgInput').value || "é †å¿ƒå¦‚æ„";
    
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const img = new Image();

    // å…è¨±è·¨åŸŸè®€å– (å°æ–¼ GitHub Pages ä¾†èªªé€šå¸¸éœ€è¦)
    img.crossOrigin = "Anonymous";
    img.src = config.bgImage;

    img.onload = function() {
        // 1. è¨­å®šç•«å¸ƒå¤§å°ç­‰æ–¼åœ–ç‰‡åŸå§‹å¤§å°
        canvas.width = img.width;
        canvas.height = img.height;

        // 2. ç¹ªè£½èƒŒæ™¯åœ–
        ctx.drawImage(img, 0, 0);

        // 3. ç¹ªè£½ã€Œåå­—ã€
        ctx.textAlign = "center"; // æ–‡å­—ç½®ä¸­
        ctx.font = `bold ${config.nameText.size} '${config.nameText.font}'`;
        ctx.fillStyle = config.nameText.color;
        ctx.fillText(nameInput, config.nameText.x, config.nameText.y);

        // 4. ç¹ªè£½ã€Œç¥ç¦èªã€
        ctx.font = `${config.msgText.size} '${config.msgText.font}'`;
        ctx.fillStyle = config.msgText.color;
        ctx.fillText(msgInput, config.msgText.x, config.msgText.y);

        // 5. è½‰æ›æˆåœ–ç‰‡ä¸¦é¡¯ç¤º
        try {
            const dataURL = canvas.toDataURL("image/png");
            const resultImg = document.getElementById('resultImage');
            const downloadBtn = document.getElementById('downloadLink');
            
            resultImg.src = dataURL;
            downloadBtn.href = dataURL;
            
            // é¡¯ç¤ºé è¦½å€
            document.getElementById('previewArea').style.display = 'block';
            
            // è‡ªå‹•æ²å‹•åˆ°åœ–ç‰‡ä½ç½®
            resultImg.scrollIntoView({ behavior: 'smooth' });
        } catch (e) {
            alert("åœ–ç‰‡ç”Ÿæˆå¤±æ•—ï¼Œè«‹ç¢ºèªç€è¦½å™¨æ”¯æ´ Canvas");
        }
    };

    img.onerror = function() {
        alert("âŒ éŒ¯èª¤ï¼šæ‰¾ä¸åˆ°èƒŒæ™¯åœ–ç‰‡ï¼\nè«‹ç¢ºèª GitHub ä¸Šæ˜¯å¦æœ‰ä¸Šå‚³åç‚º 'template.jpg' çš„æª”æ¡ˆã€‚");
    };
}
